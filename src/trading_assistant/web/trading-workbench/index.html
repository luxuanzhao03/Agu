<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>投研交易工作台</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Noto+Sans+SC:wght@400;500;700&family=JetBrains+Mono:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/ui/trading-workbench/styles.css" />
  </head>
  <body>
    <div class="backdrop"></div>
    <main class="app-shell">
      <header class="app-head" data-animate>
        <div>
          <p class="eyebrow">A股半自动交易辅助系统</p>
          <h1>投研交易工作台</h1>
          <p class="subtitle">策略参数配置 | 数据拉取 | 结果可视化 | 交易准备与执行回写</p>
        </div>
        <div class="head-actions">
          <div class="quick-links">
            <a href="/ui/">主界面</a>
            <a href="/ops/dashboard">运维看板</a>
          </div>
          <label>
            认证请求头
            <input id="authHeaderName" type="text" value="X-API-Key" />
          </label>
          <label>
            API Key（可选）
            <input id="authApiKey" type="password" placeholder="未启用鉴权可留空" />
          </label>
          <div class="actions-row">
            <button id="saveAuthBtn" type="button" class="secondary">保存认证</button>
            <button id="refreshAllBtn" type="button">刷新基础数据</button>
          </div>
          <p id="lastUpdated">最近更新时间：-</p>
        </div>
      </header>

      <div id="globalError" class="global-error hidden"></div>

      <nav class="tab-nav" data-animate>
        <button type="button" class="tab active" data-tab="strategy">策略与参数页</button>
        <button type="button" class="tab" data-tab="datahub">数据拉取页</button>
        <button type="button" class="tab" data-tab="autotune">自动调参页</button>
        <button type="button" class="tab" data-tab="challenge">跨策略挑战赛页</button>
        <button type="button" class="tab" data-tab="results">结果可视化页</button>
        <button type="button" class="tab" data-tab="holdings">持仓分析页</button>
        <button type="button" class="tab" data-tab="execution">交易准备单与执行回写页</button>
      </nav>

      <section id="tab-strategy" class="tab-panel active" data-animate>
        <div class="panel-head">
          <h2>策略与参数页</h2>
          <p>选择策略、录入参数，执行信号生成 / 回测 / 多标的研究工作流。</p>
        </div>

        <div class="grid two">
          <article class="card">
            <h3>基础配置</h3>
            <div class="form-grid">
              <label>
                单标的代码
                <input id="symbolInput" type="text" value="000001" />
              </label>
              <label>
                多标的代码（逗号/空格/换行分隔）
                <textarea id="symbolsInput" rows="3">000001,000002,600000</textarea>
              </label>
              <label>
                开始日期
                <input id="startDateInput" type="date" />
              </label>
              <label>
                结束日期
                <input id="endDateInput" type="date" />
              </label>
              <label>
                策略
                <select id="strategySelect"></select>
              </label>
              <label>
                行业（单标的可选）
                <input id="industryInput" type="text" placeholder="例如：银行" />
              </label>
              <label class="inline">
                <input id="eventEnrichInput" type="checkbox" /> 启用事件增强（event_enrichment）
              </label>
              <label>
                事件回看天数
                <input id="eventLookbackInput" type="number" min="1" max="3650" value="30" />
              </label>
              <label>
                事件衰减半衰期（天）
                <input id="eventDecayInput" type="number" min="0.1" step="0.1" value="7" />
              </label>
              <label class="inline">
                <input id="smallCapitalModeInput" type="checkbox" /> 启用小资金模式（small_capital_mode）
              </label>
              <label>
                小资金本金（small_capital_principal）
                <input id="smallCapitalPrincipalInput" type="number" min="100" step="100" value="2000" />
              </label>
              <label>
                最低安全边际（bps）
                <input id="smallCapitalMinEdgeInput" type="number" min="0" max="2000" step="1" value="80" />
              </label>
              <label class="inline">
                <input id="useAutotuneProfileInput" type="checkbox" checked /> 启用自动调参画像覆盖（use_autotune_profile）
              </label>
            </div>
            <div id="smallCapitalTemplateActions" class="actions-row wrap">
              <button type="button" class="secondary" data-small-cap-template="2000">套用 2000 档</button>
              <button type="button" class="secondary" data-small-cap-template="5000">套用 5000 档</button>
              <button type="button" class="secondary" data-small-cap-template="8000">套用 8000 档</button>
            </div>
            <p class="muted">点击模板后会一键填充小资金策略、仓位、回测与费用相关关键参数。</p>
            <p id="smallCapitalHint" class="muted">-</p>
          </article>

          <article class="card">
            <h3>策略参数（动态）</h3>
            <p id="strategyMeta" class="muted">-</p>
            <div id="strategyParamRows" class="param-rows"></div>
          </article>
        </div>

        <div class="grid two">
          <article class="card">
            <h3>信号风控上下文（可选）</h3>
            <div class="form-grid">
              <label class="inline">
                <input id="usePositionCtx" type="checkbox" /> 启用 current_position
              </label>
              <label>
                持仓数量（quantity）
                <input id="positionQty" type="number" min="0" value="0" />
              </label>
              <label>
                可卖数量（available_quantity）
                <input id="positionAvailQty" type="number" min="0" value="0" />
              </label>
              <label>
                持仓成本（avg_cost）
                <input id="positionAvgCost" type="number" min="0" step="0.0001" value="0" />
              </label>
              <label>
                持仓市值（market_value）
                <input id="positionMarketValue" type="number" min="0" step="0.01" value="0" />
              </label>
              <label>
                最近买入日（last_buy_date）
                <input id="positionLastBuyDate" type="date" />
              </label>

              <label class="inline">
                <input id="usePortfolioCtx" type="checkbox" /> 启用 portfolio_snapshot
              </label>
              <label>
                组合总资产（total_value）
                <input id="portfolioTotalValue" type="number" min="0" step="0.01" value="1000000" />
              </label>
              <label>
                现金（cash）
                <input id="portfolioCash" type="number" min="0" step="0.01" value="1000000" />
              </label>
              <label>
                峰值资产（peak_value）
                <input id="portfolioPeakValue" type="number" min="0" step="0.01" value="1000000" />
              </label>
              <label>
                当前回撤（current_drawdown）
                <input id="portfolioDrawdown" type="number" min="0" max="1" step="0.0001" value="0" />
              </label>
            </div>
          </article>

          <article class="card">
            <h3>回测与研究参数</h3>
            <div class="form-grid">
              <label>
                初始资金（initial_cash）
                <input id="initialCashInput" type="number" min="1000" step="1000" value="1000000" />
              </label>
              <label>
                手续费率（commission_rate）
                <input id="commissionRateInput" type="number" min="0" max="0.02" step="0.0001" value="0.0003" />
              </label>
              <label>
                滑点率（slippage_rate）
                <input id="slippageRateInput" type="number" min="0" max="0.02" step="0.0001" value="0.0005" />
              </label>
              <label>
                最低佣金（min_commission_cny）
                <input id="minCommissionInput" type="number" min="0" max="500" step="0.1" value="5" />
              </label>
              <label>
                卖出印花税率（stamp_duty_sell_rate）
                <input id="stampDutyRateInput" type="number" min="0" max="0.02" step="0.00001" value="0.0005" />
              </label>
              <label>
                过户费率（transfer_fee_rate）
                <input id="transferFeeRateInput" type="number" min="0" max="0.01" step="0.00001" value="0.00001" />
              </label>
              <label>
                最小交易手数（lot_size）
                <input id="lotSizeInput" type="number" min="1" step="1" value="100" />
              </label>
              <label class="inline">
                <input id="realisticCostModelInput" type="checkbox" checked /> 启用拟真成本与成交模型
              </label>
              <label>
                冲击成本系数（impact_cost_coeff）
                <input id="impactCostCoeffInput" type="number" min="0" max="5" step="0.01" value="0.18" />
              </label>
              <label>
                冲击成本指数（impact_cost_exponent）
                <input id="impactCostExponentInput" type="number" min="0.1" max="2" step="0.01" value="0.60" />
              </label>
              <label>
                最低成交概率（fill_probability_floor）
                <input id="fillProbabilityFloorInput" type="number" min="0" max="1" step="0.01" value="0.02" />
              </label>

              <label class="inline">
                <input id="optimizePortfolioInput" type="checkbox" checked /> 研究工作流启用组合优化
              </label>
              <label>
                单标的上限（max_single_position）
                <input id="maxSinglePositionInput" type="number" min="0.001" max="1" step="0.001" value="0.05" />
              </label>
              <label>
                行业敞口上限（max_industry_exposure）
                <input id="maxIndustryExposureInput" type="number" min="0.001" max="1" step="0.001" value="0.2" />
              </label>
              <label>
                目标总仓位（target_gross_exposure）
                <input id="targetGrossExposureInput" type="number" min="0.001" max="1" step="0.001" value="1" />
              </label>
              <label>
                组合回测调仓周期（rebalance_interval_days）
                <input id="portfolioRebalanceIntervalInput" type="number" min="1" max="250" step="1" value="5" />
              </label>
              <label>
                组合现金保留（cash_reserve_ratio）
                <input id="portfolioCashReserveRatioInput" type="number" min="0" max="0.95" step="0.01" value="0.05" />
              </label>
              <label>
                主题敞口上限（max_theme_exposure）
                <input id="maxThemeExposureInput" type="number" min="0.001" max="1" step="0.001" value="0.45" />
              </label>
              <label class="inline">
                <input id="portfolioRiskControlInput" type="checkbox" checked /> 启用组合回测风险控制
              </label>
              <label>
                组合回撤阈值（risk_max_drawdown）
                <input id="portfolioRiskMaxDrawdownInput" type="number" min="0" max="1" step="0.001" value="0.12" />
              </label>
              <label>
                连续亏损熔断（risk_max_consecutive_losses）
                <input id="portfolioRiskMaxConsecutiveLossesInput" type="number" min="1" max="200" step="1" value="3" />
              </label>
              <label>
                单日最大亏损（risk_max_daily_loss）
                <input id="portfolioRiskMaxDailyLossInput" type="number" min="0" max="1" step="0.001" value="0.03" />
              </label>
              <label>
                VaR置信度（risk_var_confidence）
                <input id="portfolioRiskVarConfidenceInput" type="number" min="0.5" max="0.999" step="0.001" value="0.95" />
              </label>
              <label>
                VaR阈值（risk_max_var）
                <input id="portfolioRiskMaxVarInput" type="number" min="0" max="1" step="0.001" value="0.04" />
              </label>
              <label>
                ES阈值（risk_max_es）
                <input id="portfolioRiskMaxEsInput" type="number" min="0" max="1" step="0.001" value="0.06" />
              </label>
              <label>
                收益回看天数（risk_return_lookback_days）
                <input id="portfolioRiskReturnLookbackInput" type="number" min="20" max="5000" step="1" value="252" />
              </label>
              <label>
                亏损序列回看成交数（risk_loss_streak_lookback_trades）
                <input id="portfolioRiskTradeLookbackInput" type="number" min="10" max="10000" step="1" value="300" />
              </label>
              <label>
                行业映射（每行：代码=行业）
                <textarea id="industryMapInput" rows="3" placeholder="000001=银行\n600000=银行"></textarea>
              </label>
              <label>
                主题映射（每行：代码=主题）
                <textarea id="themeMapInput" rows="3" placeholder="000001=中字头\n600000=高股息"></textarea>
              </label>
            </div>
          </article>
        </div>

        <article class="card">
          <h3>运行操作</h3>
          <div class="actions-row wrap">
            <button id="runSignalBtn" type="button">运行信号生成</button>
            <button id="runBacktestBtn" type="button">运行回测</button>
            <button id="runPortfolioBacktestBtn" type="button">运行组合净值回测</button>
            <button id="runResearchBtn" type="button">运行研究工作流</button>
            <button id="runAllBtn" type="button" class="secondary">一键全跑（信号+回测+研究）</button>
            <button id="jumpToDataFetchBtn" type="button" class="secondary">前往数据拉取页</button>
            <button id="jumpToAutotuneBtn" type="button" class="secondary">前往自动调参页</button>
            <button id="jumpToChallengeBtn" type="button" class="secondary">前往挑战赛页</button>
            <button id="jumpToHoldingsBtn" type="button" class="secondary">前往持仓分析页</button>
          </div>
          <p id="strategyActionMsg" class="muted">-</p>
          <details>
            <summary>请求体预览（便于核对字段）</summary>
            <pre id="requestPreview" class="code-block">{}</pre>
          </details>
        </article>

        <article class="card">
          <h3>自动调参闭环</h3>
          <p class="muted">自动调参迁移到独立页签，支持任务运行、候选榜、基线对比、画像激活/回滚与灰度规则。</p>
          <div class="actions-row wrap">
            <button id="jumpToAutotuneCardBtn" type="button" class="secondary">打开自动调参页</button>
          </div>
        </article>
      </section>

      <section id="tab-datahub" class="tab-panel" data-animate>
        <div class="panel-head">
          <h2>数据拉取页</h2>
          <p>按标的与时间段拉取系统所需核心数据（日线、分钟线、交易日历、数据质量、Tushare能力与预拉取）。</p>
          <div class="actions-row wrap panel-jumps">
            <button id="jumpToStrategyFromDataBtn" type="button" class="secondary">回到策略参数页</button>
            <button id="jumpToResultsFromDataBtn" type="button" class="secondary">查看结果可视化</button>
          </div>
        </div>

        <div class="grid two">
          <article class="card">
            <h3>查询参数</h3>
            <div class="form-grid">
              <label>
                主标的（symbol）
                <input id="dataFetchSymbolInput" type="text" value="000001" />
              </label>
              <label>
                多标的（逗号/空格/换行分隔）
                <textarea id="dataFetchSymbolsInput" rows="3">000001,000002,600000</textarea>
              </label>
              <label>
                日线起始（start_date）
                <input id="dataFetchStartDateInput" type="date" />
              </label>
              <label>
                日线结束（end_date）
                <input id="dataFetchEndDateInput" type="date" />
              </label>
              <label>
                分钟线起始（start_datetime）
                <input id="dataFetchIntradayStartInput" type="datetime-local" />
              </label>
              <label>
                分钟线结束（end_datetime）
                <input id="dataFetchIntradayEndInput" type="datetime-local" />
              </label>
              <label>
                分钟周期（interval）
                <select id="dataFetchIntradayIntervalInput">
                  <option value="1m">1m</option>
                  <option value="5m">5m</option>
                  <option value="15m" selected>15m</option>
                  <option value="30m">30m</option>
                  <option value="60m">60m</option>
                </select>
              </label>
              <label>
                日线返回行数（bars limit）
                <input id="dataFetchBarsLimitInput" type="number" min="1" max="200" value="120" />
              </label>
              <label>
                分钟线返回行数（intraday limit）
                <input id="dataFetchIntradayLimitInput" type="number" min="1" max="2400" value="400" />
              </label>
              <label>
                批量拉取最大标的数
                <input id="dataFetchBatchLimitInput" type="number" min="1" max="100" value="12" />
              </label>
              <label>
                Tushare 用户积分（user_points）
                <input id="dataFetchTusharePointsInput" type="number" min="0" max="1000000" value="2120" />
              </label>
              <label class="inline">
                <input id="dataFetchIncludeIneligibleInput" type="checkbox" /> prefetch 包含不满足积分的数据集
              </label>
              <label>
                全市场扫描本金（principal）
                <input id="fullMarket2000PrincipalInput" type="number" min="100" max="1000000" step="100" value="2000" />
              </label>
              <label>
                全市场单标的仓位上限（max_single_position）
                <input id="fullMarket2000MaxSinglePositionInput" type="number" min="0.05" max="1" step="0.01" value="0.6" />
              </label>
              <label>
                全市场最低安全边际（min_edge_bps）
                <input id="fullMarket2000MinEdgeBpsInput" type="number" min="0" max="5000" step="1" value="140" />
              </label>
              <label>
                全市场最大扫描标的数（0=全量）
                <input id="fullMarket2000MaxSymbolsInput" type="number" min="0" max="20000" step="1" value="0" />
              </label>
              <label>
                全市场 TopN
                <input id="fullMarket2000TopNInput" type="number" min="1" max="500" step="1" value="30" />
              </label>
              <label>
                全市场每标的间隔（sleep_ms）
                <input id="fullMarket2000SleepMsInput" type="number" min="0" max="5000" step="10" value="0" />
              </label>
              <label>
                全市场任务超时（分钟）
                <input id="fullMarket2000TimeoutMinInput" type="number" min="1" max="1440" step="1" value="120" />
              </label>
            </div>

            <div class="actions-row wrap">
              <button id="syncDataFetchParamsBtn" type="button" class="secondary">同步策略参数</button>
              <button id="runDataFetchBarsBtn" type="button">拉取日线</button>
              <button id="runDataFetchIntradayBtn" type="button">拉取分钟线</button>
              <button id="runDataFetchCalendarBtn" type="button">拉取交易日历</button>
              <button id="runDataFetchQualityBtn" type="button">数据质量评分</button>
              <button id="runDataFetchCapabilitiesBtn" type="button">Tushare 能力检测</button>
              <button id="runDataFetchPrefetchBtn" type="button">Tushare 预拉取</button>
              <button id="runDataFetchBatchBarsBtn" type="button" class="secondary">批量拉取日线</button>
              <button id="runDataFetchAllBtn" type="button" class="secondary">一键拉取系统关键数据</button>
              <button id="runFullMarket2000ScanBtn" type="button">一键扫描全市场（2000档）</button>
              <button id="cancelFullMarket2000ScanBtn" type="button" class="secondary" disabled>中止扫描</button>
            </div>
            <p id="dataFetchMsg" class="muted">-</p>
          </article>

          <article class="card">
            <h3>拉取摘要</h3>
            <div class="kpi-grid compact">
              <article class="kpi-card"><p>日线行数</p><h3 id="dataFetchBarsKpi">-</h3></article>
              <article class="kpi-card"><p>分钟线行数</p><h3 id="dataFetchIntradayKpi">-</h3></article>
              <article class="kpi-card"><p>交易日历天数</p><h3 id="dataFetchCalendarKpi">-</h3></article>
              <article class="kpi-card"><p>质量总分</p><h3 id="dataFetchQualityKpi">-</h3></article>
              <article class="kpi-card"><p>Tushare ready</p><h3 id="dataFetchReadyKpi">-</h3></article>
              <article class="kpi-card"><p>prefetch 成功/失败</p><h3 id="dataFetchPrefetchKpi">-</h3></article>
            </div>
            <p id="dataFetchAllMeta" class="muted">尚未执行一键拉取。</p>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>任务</th>
                    <th>状态</th>
                    <th>说明</th>
                  </tr>
                </thead>
                <tbody id="dataFetchAllRows"></tbody>
              </table>
            </div>
          </article>
        </div>

        <div class="grid two">
          <article class="card">
            <h3>日线结果（/market/bars）</h3>
            <p id="dataFetchBarsMeta" class="muted">-</p>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>日期</th>
                    <th>open</th>
                    <th>high</th>
                    <th>low</th>
                    <th>close</th>
                    <th>volume</th>
                    <th>provider</th>
                  </tr>
                </thead>
                <tbody id="dataFetchBarsRows"></tbody>
              </table>
            </div>
          </article>

          <article class="card">
            <h3>分钟线结果（/market/intraday）</h3>
            <p id="dataFetchIntradayMeta" class="muted">-</p>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>时间</th>
                    <th>open</th>
                    <th>high</th>
                    <th>low</th>
                    <th>close</th>
                    <th>volume</th>
                    <th>interval</th>
                    <th>provider</th>
                  </tr>
                </thead>
                <tbody id="dataFetchIntradayRows"></tbody>
              </table>
            </div>
          </article>
        </div>

        <div class="grid two">
          <article class="card">
            <h3>交易日历（/market/calendar）</h3>
            <p id="dataFetchCalendarMeta" class="muted">-</p>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>trade_date</th>
                    <th>is_open</th>
                  </tr>
                </thead>
                <tbody id="dataFetchCalendarRows"></tbody>
              </table>
            </div>
          </article>

          <article class="card">
            <h3>数据质量报告（/data/quality/report）</h3>
            <p id="dataFetchQualityMeta" class="muted">-</p>
            <div class="grid two compact">
              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>field</th>
                      <th>score</th>
                    </tr>
                  </thead>
                  <tbody id="dataFetchQualityFieldRows"></tbody>
                </table>
              </div>
              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>issue_type</th>
                      <th>severity</th>
                      <th>message</th>
                    </tr>
                  </thead>
                  <tbody id="dataFetchQualityIssueRows"></tbody>
                </table>
              </div>
            </div>
          </article>
        </div>

        <div class="grid two">
          <article class="card">
            <h3>Tushare 能力目录（/market/tushare/capabilities）</h3>
            <p id="dataFetchCapabilitiesMeta" class="muted">-</p>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>dataset</th>
                    <th>api</th>
                    <th>积分门槛</th>
                    <th>eligible</th>
                    <th>ready</th>
                    <th>已接入系统</th>
                    <th>说明</th>
                  </tr>
                </thead>
                <tbody id="dataFetchCapabilityRows"></tbody>
              </table>
            </div>
          </article>

          <article class="card">
            <h3>Tushare 预拉取结果（/market/tushare/prefetch）</h3>
            <p id="dataFetchPrefetchMeta" class="muted">-</p>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>dataset</th>
                    <th>status</th>
                    <th>rows</th>
                    <th>cols</th>
                    <th>error</th>
                  </tr>
                </thead>
                <tbody id="dataFetchPrefetchRows"></tbody>
              </table>
            </div>
          </article>
        </div>

        <article class="card">
          <h3>批量拉取摘要（多标的日线）</h3>
          <p class="muted">用于快速检查一组标的在指定区间内的数据可用性与数据源命中情况。</p>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>symbol</th>
                  <th>status</th>
                  <th>provider</th>
                  <th>row_count</th>
                  <th>message</th>
                </tr>
              </thead>
              <tbody id="dataFetchBatchRows"></tbody>
            </table>
          </div>
        </article>

        <article class="card">
          <h3>全市场2000档扫描结果（/research/full-market-2000-scan）</h3>
          <p class="muted">基于日线数据做全市场买点筛选，输出 TopN 候选及本地报告文件路径。</p>
          <div class="kpi-grid compact">
            <article class="kpi-card"><p>总标的</p><h3 id="fullMarket2000KpiTotal">-</h3></article>
            <article class="kpi-card"><p>可买通过</p><h3 id="fullMarket2000KpiBuyPass">-</h3></article>
            <article class="kpi-card"><p>错误数</p><h3 id="fullMarket2000KpiErrors">-</h3></article>
            <article class="kpi-card"><p>粒度</p><h3 id="fullMarket2000KpiGranularity">-</h3></article>
          </div>
          <p id="fullMarket2000ScanMeta" class="muted">尚未执行全市场扫描。</p>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>symbol</th>
                  <th>confidence</th>
                  <th>close</th>
                  <th>建议手数</th>
                  <th>买入区间</th>
                  <th>最高买价</th>
                  <th>risk</th>
                  <th>备注</th>
                </tr>
              </thead>
              <tbody id="fullMarket2000ScanRows"></tbody>
            </table>
          </div>
        </article>
      </section>

      <section id="tab-autotune" class="tab-panel" data-animate>
        <div class="panel-head">
          <h2>自动调参页</h2>
          <p>运行调参任务、查看候选榜与基线对比，并管理参数画像回滚与按标的/按策略灰度启用。</p>
          <div class="actions-row wrap panel-jumps">
            <button id="jumpToStrategyFromAutotuneBtn" type="button" class="secondary">回到策略参数页</button>
            <button id="jumpToResultsFromAutotuneBtn" type="button" class="secondary">查看结果可视化</button>
          </div>
        </div>

        <div class="grid two">
          <article class="card">
            <h3>调参任务配置（/autotune/run）</h3>
            <div class="form-grid">
              <label>
                run_by
                <input id="autotuneRunByInput" type="text" value="workbench_user" />
              </label>
              <label class="inline">
                <input id="autotuneAutoApplyInput" type="checkbox" checked /> 自动应用最优画像（auto_apply）
              </label>
              <label>
                apply_scope
                <select id="autotuneApplyScopeInput">
                  <option value="GLOBAL">GLOBAL</option>
                  <option value="SYMBOL">SYMBOL</option>
                </select>
              </label>
              <label>
                max_combinations
                <input id="autotuneMaxCombInput" type="number" min="1" max="5000" value="120" />
              </label>
              <label>
                validation_ratio
                <input id="autotuneValidationRatioInput" type="number" min="0" max="0.8" step="0.01" value="0.2" />
              </label>
              <label>
                validation_weight
                <input id="autotuneValidationWeightInput" type="number" min="0" max="1" step="0.01" value="0.4" />
              </label>
              <label>
                min_train_bars
                <input id="autotuneMinTrainBarsInput" type="number" min="20" max="5000" value="120" />
              </label>
              <label>
                min_validation_bars
                <input id="autotuneMinValidationBarsInput" type="number" min="10" max="5000" value="40" />
              </label>
              <label>
                min_trade_count
                <input id="autotuneMinTradeCountInput" type="number" min="0" max="5000" value="1" />
              </label>
              <label>
                low_trade_penalty
                <input id="autotuneLowTradePenaltyInput" type="number" min="0" max="5" step="0.01" value="0.15" />
              </label>
              <label>
                objective_weight_overfit_gap
                <input id="autotuneOverfitWeightInput" type="number" min="0" max="5" step="0.01" value="0.2" />
              </label>
              <label>
                objective_weight_stability
                <input id="autotuneStabilityWeightInput" type="number" min="0" max="5" step="0.01" value="0.15" />
              </label>
              <label>
                objective_weight_param_drift
                <input id="autotuneParamDriftWeightInput" type="number" min="0" max="5" step="0.01" value="0.1" />
              </label>
              <label>
                objective_weight_return_variance
                <input id="autotuneReturnVarWeightInput" type="number" min="0" max="5" step="0.01" value="0.08" />
              </label>
              <label>
                stability_eval_top_n
                <input id="autotuneStabilityTopNInput" type="number" min="0" max="500" value="24" />
              </label>
              <label>
                walk_forward_slices
                <input id="autotuneWalkForwardSlicesInput" type="number" min="0" max="12" value="4" />
              </label>
              <label>
                low_sample_penalty
                <input id="autotuneLowSamplePenaltyInput" type="number" min="0" max="5" step="0.01" value="0.1" />
              </label>
              <label>
                min_improvement_to_apply
                <input id="autotuneMinImprovementInput" type="number" min="-5" max="5" step="0.001" value="0" />
              </label>
              <label class="inline">
                <input id="autotuneRequireValidationInput" type="checkbox" checked /> apply_require_validation
              </label>
              <label>
                apply_min_validation_total_return
                <input id="autotuneMinValidationReturnInput" type="number" min="-1" max="5" step="0.001" value="0" />
              </label>
              <label>
                apply_max_train_validation_gap
                <input id="autotuneMaxGapInput" type="number" min="0" max="5" step="0.001" value="0.45" />
              </label>
              <label>
                apply_min_walk_forward_samples
                <input id="autotuneMinWfSamplesInput" type="number" min="0" max="20" value="2" />
              </label>
              <label class="inline">
                <input id="autotuneCreateGovDraftInput" type="checkbox" checked /> create_governance_draft
              </label>
              <label class="inline">
                <input id="autotuneSubmitReviewInput" type="checkbox" /> governance_submit_review
              </label>
              <label class="inline">
                <input id="autotuneRealisticCostInput" type="checkbox" checked /> enable_realistic_cost_model
              </label>
              <label>
                impact_cost_coeff
                <input id="autotuneImpactCoeffInput" type="number" min="0" max="5" step="0.01" value="0.18" />
              </label>
              <label>
                impact_cost_exponent
                <input id="autotuneImpactExponentInput" type="number" min="0.1" max="2" step="0.01" value="0.6" />
              </label>
              <label>
                fill_probability_floor
                <input id="autotuneFillProbFloorInput" type="number" min="0" max="1" step="0.01" value="0.02" />
              </label>
              <label>
                search_space(JSON，可选)
                <textarea id="autotuneSearchSpaceInput" rows="5" placeholder="{&#10;  &quot;entry_ma_fast&quot;: [10, 15, 20],&#10;  &quot;entry_ma_slow&quot;: [40, 60, 80]&#10;}"></textarea>
              </label>
            </div>
            <div class="actions-row wrap">
              <button id="runAutotuneBtn" type="button">运行自动调参</button>
              <button id="loadAutotuneActiveBtn" type="button" class="secondary">读取当前生效画像</button>
              <button id="loadAutotuneProfilesBtn" type="button" class="secondary">加载画像列表</button>
              <button id="applyAutotuneBestParamsBtn" type="button" class="secondary">将最优参数回填到策略区</button>
            </div>
            <div class="actions-row wrap">
              <label>
                回滚 scope
                <select id="autotuneRollbackScopeInput">
                  <option value="AUTO">AUTO</option>
                  <option value="GLOBAL">GLOBAL</option>
                  <option value="SYMBOL">SYMBOL</option>
                </select>
              </label>
              <button id="rollbackAutotuneBtn" type="button" class="secondary">一键回滚上一个画像</button>
            </div>
            <p id="autotuneMsg" class="muted">-</p>
            <div class="kpi-grid compact">
              <article class="kpi-card"><p>评估候选数</p><h3 id="autotuneEvalCount">-</h3></article>
              <article class="kpi-card"><p>最优目标值</p><h3 id="autotuneBestObjective">-</h3></article>
              <article class="kpi-card"><p>相对基线提升</p><h3 id="autotuneImprovement">-</h3></article>
              <article class="kpi-card"><p>应用决策</p><h3 id="autotuneApplyDecision">-</h3></article>
            </div>
          </article>

          <article class="card">
            <h3>画像灰度规则（/autotune/rollout/rules）</h3>
            <p class="muted">留空 symbol 表示按策略全局灰度；填写 symbol 表示仅该标的命中规则。</p>
            <div class="form-grid">
              <label>
                strategy_name（自动取当前策略）
                <input id="rolloutRuleStrategyInput" type="text" placeholder="留空=使用当前策略" />
              </label>
              <label>
                symbol（可选）
                <input id="rolloutRuleSymbolInput" type="text" placeholder="留空=策略级" />
              </label>
              <label class="inline">
                <input id="rolloutRuleEnabledInput" type="checkbox" checked /> enabled（true=启用画像，false=禁用画像）
              </label>
              <label>
                note
                <textarea id="rolloutRuleNoteInput" rows="3" placeholder="灰度说明，例如：先在000001试运行3天"></textarea>
              </label>
            </div>
            <div class="actions-row wrap">
              <button id="upsertRolloutRuleBtn" type="button">保存灰度规则</button>
              <button id="loadRolloutRulesBtn" type="button" class="secondary">加载灰度规则</button>
            </div>
            <p id="rolloutRuleMsg" class="muted">-</p>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>id</th>
                    <th>strategy</th>
                    <th>symbol</th>
                    <th>enabled</th>
                    <th>updated_at</th>
                    <th>note</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody id="rolloutRuleRows"></tbody>
              </table>
            </div>
          </article>
        </div>

        <div class="grid two">
          <article class="card">
            <h3>候选排行榜</h3>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>rank</th>
                    <th>objective</th>
                    <th>train_score</th>
                    <th>validation_score</th>
                    <th>overfit_penalty</th>
                    <th>stability_penalty</th>
                    <th>param_drift_penalty</th>
                    <th>return_variance_penalty</th>
                    <th>wf_samples</th>
                    <th>apply_guard</th>
                    <th>params</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody id="autotuneCandidateRows"></tbody>
              </table>
            </div>
          </article>

          <article class="card">
            <h3>参数画像列表（支持激活/回退）</h3>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>id</th>
                    <th>strategy</th>
                    <th>scope</th>
                    <th>symbol</th>
                    <th>objective</th>
                    <th>active</th>
                    <th>updated_at</th>
                    <th>source_run_id</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody id="autotuneProfileRows"></tbody>
              </table>
            </div>
            <h4>基线 vs 最优 对比</h4>
            <p id="autotuneCompareMeta" class="muted">暂无自动调参结果。</p>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>维度</th>
                    <th>基线</th>
                    <th>最优</th>
                  </tr>
                </thead>
                <tbody id="autotuneCompareRows"></tbody>
              </table>
            </div>
          </article>
        </div>
      </section>

      <section id="tab-challenge" class="tab-panel" data-animate>
        <div class="panel-head">
          <h2>跨策略挑战赛页</h2>
          <p>一键并行评测六策略：先调参，再按样本外硬门槛筛选，最后按综合分产出冠军/亚军与灰度上线建议。</p>
          <div class="actions-row wrap panel-jumps">
            <button id="jumpToStrategyFromChallengeBtn" type="button" class="secondary">回到策略参数页</button>
            <button id="jumpToAutotuneFromChallengeBtn" type="button" class="secondary">打开自动调参页</button>
            <button id="jumpToResultsFromChallengeBtn" type="button" class="secondary">查看结果可视化</button>
          </div>
        </div>

        <div class="grid two">
          <article class="card">
            <h3>挑战赛配置（/challenge/run）</h3>
            <div class="form-grid">
              <label>
                run_by
                <input id="challengeRunByInput" type="text" value="workbench_user" />
              </label>
              <label>
                per_strategy_max_combinations
                <input id="challengePerStrategyMaxCombInput" type="number" min="1" max="5000" value="120" />
              </label>
              <label>
                validation_ratio
                <input id="challengeValidationRatioInput" type="number" min="0" max="0.8" step="0.01" value="0.2" />
              </label>
              <label>
                validation_weight
                <input id="challengeValidationWeightInput" type="number" min="0" max="1" step="0.01" value="0.4" />
              </label>
              <label>
                min_train_bars
                <input id="challengeMinTrainBarsInput" type="number" min="20" max="5000" value="120" />
              </label>
              <label>
                min_validation_bars
                <input id="challengeMinValidationBarsInput" type="number" min="10" max="5000" value="40" />
              </label>
              <label>
                min_trade_count
                <input id="challengeMinTradeCountInput" type="number" min="0" max="5000" value="1" />
              </label>
              <label>
                walk_forward_slices
                <input id="challengeWalkForwardSlicesInput" type="number" min="0" max="12" value="4" />
              </label>
              <label>
                stability_eval_top_n
                <input id="challengeStabilityTopNInput" type="number" min="0" max="500" value="24" />
              </label>
              <label>
                low_sample_penalty
                <input id="challengeLowSamplePenaltyInput" type="number" min="0" max="5" step="0.01" value="0.1" />
              </label>

              <label class="inline">
                <input id="challengeGateRequireValidationInput" type="checkbox" checked /> gate_require_validation
              </label>
              <label>
                gate_min_validation_total_return
                <input id="challengeGateMinValidationReturnInput" type="number" min="-1" max="5" step="0.001" value="0" />
              </label>
              <label>
                gate_max_validation_drawdown
                <input id="challengeGateMaxValidationDrawdownInput" type="number" min="0" max="1" step="0.001" value="0.25" />
              </label>
              <label>
                gate_min_validation_sharpe
                <input id="challengeGateMinValidationSharpeInput" type="number" min="-10" max="20" step="0.01" value="0" />
              </label>
              <label>
                gate_min_validation_trade_count
                <input id="challengeGateMinValidationTradeCountInput" type="number" min="0" max="10000" value="1" />
              </label>
              <label>
                gate_min_walk_forward_samples
                <input id="challengeGateMinWfSamplesInput" type="number" min="0" max="50" value="2" />
              </label>
              <label>
                gate_max_walk_forward_return_std
                <input id="challengeGateMaxWfStdInput" type="number" min="0" max="5" step="0.001" value="0.2" />
              </label>

              <label>
                rank_weight_validation_return
                <input id="challengeRankWeightReturnInput" type="number" min="0" max="5" step="0.01" value="0.55" />
              </label>
              <label>
                rank_weight_validation_sharpe
                <input id="challengeRankWeightSharpeInput" type="number" min="0" max="5" step="0.01" value="0.25" />
              </label>
              <label>
                rank_weight_stability
                <input id="challengeRankWeightStabilityInput" type="number" min="0" max="5" step="0.01" value="0.2" />
              </label>
              <label>
                rank_weight_drawdown_penalty
                <input id="challengeRankWeightDrawdownInput" type="number" min="0" max="5" step="0.01" value="0.35" />
              </label>
              <label>
                rank_weight_variance_penalty
                <input id="challengeRankWeightVarianceInput" type="number" min="0" max="5" step="0.01" value="0.2" />
              </label>
              <label>
                rollout_gray_days
                <input id="challengeRolloutGrayDaysInput" type="number" min="7" max="20" value="10" />
              </label>

              <div>
                <p class="muted">参赛策略（全不勾选=后端按默认6策略）</p>
                <div id="challengeStrategyPickers" class="inline-picks">
                  <label class="inline"><input type="checkbox" class="challenge-strategy-picker" value="trend_following" checked /> trend_following</label>
                  <label class="inline"><input type="checkbox" class="challenge-strategy-picker" value="mean_reversion" checked /> mean_reversion</label>
                  <label class="inline"><input type="checkbox" class="challenge-strategy-picker" value="multi_factor" checked /> multi_factor</label>
                  <label class="inline"><input type="checkbox" class="challenge-strategy-picker" value="sector_rotation" checked /> sector_rotation</label>
                  <label class="inline"><input type="checkbox" class="challenge-strategy-picker" value="event_driven" checked /> event_driven</label>
                  <label class="inline"><input type="checkbox" class="challenge-strategy-picker" value="small_capital_adaptive" checked /> small_capital_adaptive</label>
                </div>
              </div>
              <label>
                base_strategy_params_map(JSON，可选)
                <textarea id="challengeBaseParamsMapInput" rows="4" placeholder="{&#10;  &quot;trend_following&quot;: { &quot;entry_ma_fast&quot;: 20, &quot;entry_ma_slow&quot;: 60, &quot;atr_multiplier&quot;: 2.0 }&#10;}"></textarea>
              </label>
              <label>
                search_space_map(JSON，可选)
                <textarea id="challengeSearchSpaceMapInput" rows="6" placeholder="{&#10;  &quot;trend_following&quot;: {&quot;entry_ma_fast&quot;:[10,15,20],&quot;entry_ma_slow&quot;:[40,60,80]},&#10;  &quot;mean_reversion&quot;: {&quot;z_enter&quot;:[1.8,2.0,2.2]}&#10;}"></textarea>
              </label>
            </div>
            <div class="actions-row wrap">
              <button id="runChallengeBtn" type="button">运行跨策略挑战赛</button>
              <button id="applyChallengeChampionBtn" type="button" class="secondary">冠军参数回填到策略页</button>
            </div>
            <p id="challengeMsg" class="muted">-</p>
            <div class="kpi-grid compact">
              <article class="kpi-card"><p>评估总候选</p><h3 id="challengeEvaluatedCount">-</h3></article>
              <article class="kpi-card"><p>入围策略数</p><h3 id="challengeQualifiedCount">-</h3></article>
              <article class="kpi-card"><p>冠军策略</p><h3 id="challengeChampion">-</h3></article>
              <article class="kpi-card"><p>亚军策略</p><h3 id="challengeRunnerUp">-</h3></article>
            </div>
          </article>

          <article class="card">
            <h3>挑战赛结论与灰度计划</h3>
            <p id="challengeSummaryMeta" class="muted">尚未运行挑战赛。</p>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>计划项</th>
                    <th>值</th>
                  </tr>
                </thead>
                <tbody id="challengePlanRows"></tbody>
              </table>
            </div>
            <h4>淘汰原因汇总</h4>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>策略</th>
                    <th>是否入围</th>
                    <th>原因</th>
                  </tr>
                </thead>
                <tbody id="challengeReasonRows"></tbody>
              </table>
            </div>
          </article>
        </div>

        <article class="card">
          <h3>挑战赛候选榜（按入围优先+综合分排序）</h3>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>策略</th>
                  <th>入围</th>
                  <th>综合分</th>
                  <th>validation_return</th>
                  <th>validation_mdd</th>
                  <th>validation_sharpe</th>
                  <th>wf_samples</th>
                  <th>wf_return_std</th>
                  <th>stability_penalty</th>
                  <th>param_drift_penalty</th>
                  <th>return_variance_penalty</th>
                  <th>best_params</th>
                </tr>
              </thead>
              <tbody id="challengeResultRows"></tbody>
            </table>
          </div>
        </article>
      </section>

      <section id="tab-results" class="tab-panel" data-animate>
        <div class="panel-head">
          <h2>结果可视化页</h2>
          <p>展示候选信号、风控命中、K线叠加、组合权重与回测关键指标。</p>
          <div class="actions-row wrap panel-jumps">
            <button id="jumpToStrategyBtn" type="button" class="secondary">回到策略参数页</button>
            <button id="jumpToAutotuneFromResultsHeadBtn" type="button" class="secondary">前往自动调参页</button>
            <button id="jumpToExecutionBtn" type="button" class="secondary">前往执行回写页</button>
          </div>
        </div>

        <div class="kpi-grid">
          <article class="kpi-card"><p>信号数量</p><h3 id="kpiSignalCount">-</h3></article>
          <article class="kpi-card"><p>买入建议</p><h3 id="kpiBuyCount">-</h3></article>
          <article class="kpi-card"><p>阻断数量</p><h3 id="kpiBlockedCount">-</h3></article>
          <article class="kpi-card"><p>回测总收益</p><h3 id="kpiBacktestReturn">-</h3></article>
          <article class="kpi-card"><p>最大回撤</p><h3 id="kpiBacktestMdd">-</h3></article>
          <article class="kpi-card"><p>夏普比率</p><h3 id="kpiBacktestSharpe">-</h3></article>
          <article class="kpi-card"><p>研究候选数</p><h3 id="kpiResearchSignals">-</h3></article>
        </div>

        <article class="card">
          <h3>自动调参工作台入口</h3>
          <p id="autotuneResultsMeta" class="muted">自动调参详细候选榜、基线对比、画像回滚和灰度规则请在“自动调参页”查看。</p>
          <div class="actions-row wrap">
            <button id="jumpToAutotuneFromResultsBtn" type="button" class="secondary">打开自动调参页</button>
          </div>
        </article>

        <div class="grid two">
          <article class="card">
            <h3>信号与交易准备单</h3>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>标的</th>
                    <th>日期</th>
                    <th>动作</th>
                    <th>置信度</th>
                    <th>财报评分</th>
                    <th>小资金提示</th>
                    <th>风控等级</th>
                    <th>阻断</th>
                    <th>原因</th>
                    <th>signal_id</th>
                  </tr>
                </thead>
                <tbody id="signalRows"></tbody>
              </table>
            </div>
          </article>
          <article class="card">
            <h3>风控命中明细</h3>
            <p id="riskSummary" class="muted">-</p>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>规则</th>
                    <th>通过</th>
                    <th>等级</th>
                    <th>说明</th>
                  </tr>
                </thead>
                <tbody id="riskHitRows"></tbody>
              </table>
            </div>
            <h4>建议动作</h4>
            <ul id="recommendationList" class="list"></ul>
            <h4>免责声明</h4>
            <p id="disclaimerText" class="muted">-</p>
          </article>
        </div>

        <div class="grid two">
          <article class="card">
            <h3>研究工作流候选列表</h3>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>标的</th>
                    <th>来源</th>
                    <th>动作</th>
                    <th>置信度</th>
                    <th>财报评分</th>
                    <th>小资金提示</th>
                    <th>阻断</th>
                    <th>等级</th>
                    <th>事件行数</th>
                    <th>signal_id</th>
                  </tr>
                </thead>
                <tbody id="researchRows"></tbody>
              </table>
            </div>
          </article>
          <article class="card">
            <h3>组合优化结果</h3>
            <div id="optimizeMeta" class="muted">-</div>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>标的</th>
                    <th>权重</th>
                    <th>行业</th>
                    <th>评分</th>
                  </tr>
                </thead>
                <tbody id="optWeightRows"></tbody>
              </table>
            </div>
          </article>
        </div>

        <article class="card">
          <h3>K线 / 价格走势叠加信号点位（/market/bars）</h3>
          <div class="actions-row wrap">
            <label>
              symbol
              <input id="barsSymbolInput" type="text" value="000001" />
            </label>
            <label>
              start_date
              <input id="barsStartDateInput" type="date" />
            </label>
            <label>
              end_date
              <input id="barsEndDateInput" type="date" />
            </label>
            <label>
              limit
              <input id="barsLimitInput" type="number" min="1" max="200" value="120" />
            </label>
            <button id="syncBarsParamsBtn" type="button" class="secondary">同步策略参数</button>
            <button id="loadBarsBtn" type="button">加载K线并叠加信号</button>
          </div>
          <p id="barsMeta" class="muted">-</p>
          <div id="marketKlineChart" class="chart-wrap"></div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>日期</th>
                  <th>open</th>
                  <th>high</th>
                  <th>low</th>
                  <th>close</th>
                  <th>volume</th>
                </tr>
              </thead>
              <tbody id="barRows"></tbody>
            </table>
          </div>
        </article>

        <div class="grid two">
          <article class="card">
            <h3>研究结果组合权重可视化</h3>
            <p id="weightVisualMeta" class="muted">运行研究工作流后自动展示目标权重与行业暴露。</p>
            <div class="grid two compact">
              <div>
                <h4>目标权重（按symbol）</h4>
                <div id="targetWeightChart" class="chart-wrap compact"></div>
              </div>
              <div>
                <h4>行业暴露</h4>
                <div id="industryExposureChart" class="chart-wrap compact"></div>
              </div>
            </div>
          </article>
          <article class="card">
            <h3>调仓建议联动（/portfolio/rebalance/plan）</h3>
            <p class="muted">使用研究结果中的优化权重生成调仓建议。当前持仓每行格式：symbol,quantity,last_price</p>
            <div class="form-grid">
              <label>
                total_equity
                <input id="rebalanceTotalEquityInput" type="number" min="1" step="0.01" value="1000000" />
              </label>
              <label>
                lot_size
                <input id="rebalanceLotSizeInput" type="number" min="1" step="1" value="100" />
              </label>
              <label>
                current_positions（每行）
                <textarea id="rebalancePositionsInput" rows="5" placeholder="000001,2000,12.35&#10;600000,1000,8.66"></textarea>
              </label>
            </div>
            <div class="actions-row wrap">
              <button id="syncRebalanceParamsBtn" type="button" class="secondary">同步默认资金/手数</button>
              <button id="runRebalanceBtn" type="button">生成调仓建议</button>
              <button id="useBuySignalsAsPositionBtn" type="button" class="secondary">用买入信号构造持仓样例</button>
            </div>
            <p id="rebalanceMeta" class="muted">-</p>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>symbol</th>
                    <th>side</th>
                    <th>target_weight</th>
                    <th>delta_weight</th>
                    <th>quantity</th>
                    <th>estimated_notional</th>
                  </tr>
                </thead>
                <tbody id="rebalanceRows"></tbody>
              </table>
            </div>
          </article>
        </div>

        <article class="card">
          <h3>组合净值回测（/backtest/portfolio-run）</h3>
          <p id="portfolioBacktestMeta" class="muted">暂无组合级回测结果。可回到“策略与参数页”点击“运行组合净值回测”。</p>
          <div class="kpi-grid compact">
            <article class="kpi-card"><p>总收益</p><h3 id="portfolioReturnKpi">-</h3></article>
            <article class="kpi-card"><p>最大回撤</p><h3 id="portfolioMddKpi">-</h3></article>
            <article class="kpi-card"><p>夏普</p><h3 id="portfolioSharpeKpi">-</h3></article>
            <article class="kpi-card"><p>平均资金利用率</p><h3 id="portfolioUtilKpi">-</h3></article>
            <article class="kpi-card"><p>成交笔数</p><h3 id="portfolioTradeCountKpi">-</h3></article>
          </div>
          <div id="portfolioEquityChart" class="chart-wrap"></div>
          <div class="grid two">
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>symbol</th>
                    <th>最终权重</th>
                    <th>行业</th>
                    <th>主题</th>
                  </tr>
                </thead>
                <tbody id="portfolioWeightRows"></tbody>
              </table>
            </div>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>date</th>
                    <th>symbol</th>
                    <th>action</th>
                    <th>price</th>
                    <th>qty</th>
                    <th>fee</th>
                    <th>fill</th>
                  </tr>
                </thead>
                <tbody id="portfolioTradeRows"></tbody>
              </table>
            </div>
          </div>
        </article>

        <article class="card">
          <h3>回测曲线</h3>
          <div id="equityChart" class="chart-wrap"></div>
        </article>

        <div class="grid two">
          <article class="card">
            <h3>回测指标明细</h3>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>指标</th>
                    <th>数值</th>
                  </tr>
                </thead>
                <tbody id="backtestMetricRows"></tbody>
              </table>
            </div>
          </article>
          <article class="card">
            <h3>成交记录</h3>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>日期</th>
                    <th>动作</th>
                    <th>价格</th>
                    <th>数量</th>
                    <th>费用</th>
                    <th>阻断</th>
                    <th>原因</th>
                  </tr>
                </thead>
                <tbody id="tradeRows"></tbody>
              </table>
            </div>
          </article>
        </div>
      </section>

      <section id="tab-holdings" class="tab-panel" data-animate>
        <div class="panel-head">
          <h2>持仓分析页</h2>
          <p>手工录入每笔交易，系统基于总体持仓生成当日行情分析、次日预测和策略建议。</p>
          <div class="actions-row wrap panel-jumps">
            <button id="jumpToStrategyFromHoldingsBtn" type="button" class="secondary">回到策略参数页</button>
            <button id="jumpToResultsFromHoldingsBtn" type="button" class="secondary">查看结果可视化</button>
            <button id="jumpToExecutionFromHoldingsBtn" type="button" class="secondary">前往执行回写页</button>
          </div>
        </div>

        <div class="grid two">
          <article class="card">
            <h3>手工成交录入（/holdings/trades）</h3>
            <div class="form-grid">
              <label>
                trade_date
                <input id="holdingTradeDateInput" type="date" />
              </label>
              <label>
                symbol
                <input id="holdingTradeSymbolInput" type="text" placeholder="例如：000001" />
              </label>
              <label>
                symbol_name
                <input id="holdingTradeNameInput" type="text" placeholder="例如：平安银行" />
              </label>
              <label>
                side
                <select id="holdingTradeSideInput">
                  <option value="BUY">BUY</option>
                  <option value="SELL">SELL</option>
                </select>
              </label>
              <label>
                price
                <input id="holdingTradePriceInput" type="number" min="0.0001" step="0.0001" value="0" />
              </label>
              <label>
                lots
                <input id="holdingTradeLotsInput" type="number" min="1" step="1" value="1" />
              </label>
              <label>
                lot_size
                <input id="holdingTradeLotSizeInput" type="number" min="1" step="1" value="100" />
              </label>
              <label>
                fee
                <input id="holdingTradeFeeInput" type="number" min="0" step="0.0001" value="0" />
              </label>
              <label>
                reference_price（可选）
                <input id="holdingTradeReferencePriceInput" type="number" min="0" step="0.0001" placeholder="默认留空" />
              </label>
              <label>
                executed_at（可选）
                <input id="holdingTradeExecutedAtInput" type="datetime-local" />
              </label>
              <label class="inline">
                <input id="holdingTradePartialFillInput" type="checkbox" /> is_partial_fill
              </label>
              <label>
                unfilled_reason（可选）
                <input id="holdingTradeUnfilledReasonInput" type="text" placeholder="如：流动性不足/撤单" />
              </label>
              <label>
                note
                <textarea id="holdingTradeNoteInput" rows="3" placeholder="记录手工成交补充说明"></textarea>
              </label>
            </div>
            <div class="actions-row wrap">
              <button id="submitHoldingTradeBtn" type="button">提交成交</button>
              <button id="loadHoldingTradesBtn" type="button" class="secondary">刷新成交台账</button>
              <button id="loadHoldingPositionsBtn" type="button" class="secondary">刷新持仓快照</button>
            </div>
            <p id="holdingMsg" class="muted">-</p>
          </article>

          <article class="card">
            <h3>次日预测与建议参数（/holdings/analyze）</h3>
            <p class="muted">默认读取“策略与参数页”的 strategy_name 与 strategy_params，也可在此页单独覆盖。</p>
            <div class="form-grid">
              <label>
                as_of_date
                <input id="holdingAsOfDateInput" type="date" />
              </label>
              <label>
                strategy_name（可选覆盖）
                <input id="holdingAnalyzeStrategyInput" type="text" placeholder="留空=使用当前策略" />
              </label>
              <label>
                available_cash
                <input id="holdingAvailableCashInput" type="number" min="0" step="0.01" value="0" />
              </label>
              <label>
                max_new_buys
                <input id="holdingMaxNewBuysInput" type="number" min="0" max="50" step="1" value="3" />
              </label>
              <label>
                max_single_position_ratio
                <input id="holdingMaxSingleRatioInput" type="number" min="0.01" max="1" step="0.01" value="0.35" />
              </label>
              <label>
                lot_size
                <input id="holdingAnalyzeLotSizeInput" type="number" min="1" step="1" value="100" />
              </label>
              <label>
                intraday_interval
                <select id="holdingIntradayIntervalInput">
                  <option value="15m" selected>15m（推荐）</option>
                  <option value="5m">5m</option>
                  <option value="30m">30m</option>
                  <option value="60m">60m</option>
                  <option value="1m">1m</option>
                </select>
              </label>
              <label>
                intraday_lookback_days
                <input id="holdingIntradayLookbackInput" type="number" min="1" max="15" step="1" value="5" />
              </label>
              <label>
                candidate_symbols（逗号/空格/换行分隔）
                <textarea id="holdingCandidateSymbolsInput" rows="4" placeholder="000001,600000,000333"></textarea>
              </label>
            </div>
            <div class="actions-row wrap">
              <button id="syncHoldingStrategyBtn" type="button" class="secondary">同步策略页参数</button>
              <button id="runHoldingAnalyzeBtn" type="button">生成次日建议</button>
            </div>
            <p class="muted">建议表会给出：买入/加仓/减仓/退出动作、目标手数、置信度、预期收益与风险标签。</p>
          </article>
        </div>

        <article class="card">
          <h3>策略准确性看板（/reports/strategy-accuracy）</h3>
          <p class="muted">用样本外命中率、Brier 分数、收益偏差、成本后收益评估当前策略在真实手工执行环境下的可靠性。</p>
          <div class="actions-row wrap">
            <label>
              lookback_days
              <input id="holdingAccLookbackInput" type="number" min="1" max="3650" step="1" value="90" />
            </label>
            <label>
              end_date
              <input id="holdingAccEndDateInput" type="date" />
            </label>
            <label>
              strategy_name（可选）
              <input id="holdingAccStrategyInput" type="text" placeholder="留空=全部策略" />
            </label>
            <label>
              symbol（可选）
              <input id="holdingAccSymbolInput" type="text" placeholder="留空=全部标的" />
            </label>
            <label>
              min_confidence
              <input id="holdingAccMinConfidenceInput" type="number" min="0" max="1" step="0.01" value="0" />
            </label>
            <label>
              limit
              <input id="holdingAccLimitInput" type="number" min="1" max="20000" step="1" value="4000" />
            </label>
            <button id="loadHoldingAccuracyBtn" type="button">刷新准确性看板</button>
          </div>
          <p id="holdingAccuracyMeta" class="muted">尚未加载准确性报告。</p>

          <div class="kpi-grid compact">
            <article class="kpi-card"><p>样本数</p><h3 id="holdingAccSampleKpi">-</h3></article>
            <article class="kpi-card"><p>命中率</p><h3 id="holdingAccHitRateKpi">-</h3></article>
            <article class="kpi-card"><p>Brier</p><h3 id="holdingAccBrierKpi">-</h3></article>
            <article class="kpi-card"><p>成本后收益</p><h3 id="holdingAccCostAdjKpi">-</h3></article>
            <article class="kpi-card"><p>执行覆盖率</p><h3 id="holdingAccCoverageKpi">-</h3></article>
          </div>

          <div class="grid two">
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>strategy</th>
                    <th>sample</th>
                    <th>hit_rate</th>
                    <th>brier</th>
                    <th>bias</th>
                    <th>cost_adj</th>
                    <th>coverage</th>
                  </tr>
                </thead>
                <tbody id="holdingAccByStrategyRows"></tbody>
              </table>
            </div>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>symbol</th>
                    <th>sample</th>
                    <th>hit_rate</th>
                    <th>brier</th>
                    <th>bias</th>
                    <th>cost_adj</th>
                    <th>coverage</th>
                  </tr>
                </thead>
                <tbody id="holdingAccBySymbolRows"></tbody>
              </table>
            </div>
          </div>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>as_of</th>
                  <th>next_trade</th>
                  <th>strategy</th>
                  <th>symbol</th>
                  <th>action</th>
                  <th>confidence</th>
                  <th>exp_ret</th>
                  <th>real_ret</th>
                  <th>hit</th>
                  <th>brier</th>
                  <th>executed</th>
                  <th>cost_bps</th>
                  <th>cost_adj_ret</th>
                </tr>
              </thead>
              <tbody id="holdingAccDetailRows"></tbody>
            </table>
          </div>
          <h4>解读提示</h4>
          <ul id="holdingAccuracyNoteList" class="list"></ul>
        </article>

        <article class="card">
          <h3>上线准入门槛表（/reports/go-live-readiness）</h3>
          <p class="muted">统一判断是否可继续灰度：硬门槛（准确性/成本/执行/挑战赛）+ 自动回滚触发器 + 每日验收清单。</p>
          <div class="actions-row wrap">
            <label>
              lookback_days
              <input id="goLiveLookbackInput" type="number" min="1" max="3650" step="1" value="90" />
            </label>
            <label>
              end_date
              <input id="goLiveEndDateInput" type="date" />
            </label>
            <label>
              strategy_name（可选）
              <input id="goLiveStrategyInput" type="text" placeholder="留空=全策略口径" />
            </label>
            <label>
              symbol（可选）
              <input id="goLiveSymbolInput" type="text" placeholder="留空=全标的口径" />
            </label>
            <label>
              min_confidence
              <input id="goLiveMinConfidenceInput" type="number" min="0" max="1" step="0.01" value="0" />
            </label>
            <label>
              limit
              <input id="goLiveLimitInput" type="number" min="1" max="20000" step="1" value="4000" />
            </label>
            <button id="loadGoLiveReadinessBtn" type="button">刷新上线准入报告</button>
          </div>
          <p id="goLiveMeta" class="muted">尚未加载上线准入报告。</p>
          <div class="kpi-grid compact">
            <article class="kpi-card"><p>是否可灰度</p><h3 id="goLivePassKpi">-</h3></article>
            <article class="kpi-card"><p>Readiness</p><h3 id="goLiveLevelKpi">-</h3></article>
            <article class="kpi-card"><p>硬失败门槛</p><h3 id="goLiveFailedGateKpi">-</h3></article>
            <article class="kpi-card"><p>预警门槛</p><h3 id="goLiveWarnGateKpi">-</h3></article>
          </div>

          <div class="grid two">
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>gate</th>
                    <th>passed</th>
                    <th>actual</th>
                    <th>threshold</th>
                    <th>rule</th>
                    <th>severity</th>
                    <th>detail</th>
                  </tr>
                </thead>
                <tbody id="goLiveGateRows"></tbody>
              </table>
            </div>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>rollback trigger</th>
                    <th>condition</th>
                    <th>action</th>
                    <th>owner</th>
                  </tr>
                </thead>
                <tbody id="goLiveRollbackRows"></tbody>
              </table>
            </div>
          </div>

          <h4>每日验收清单</h4>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>item</th>
                  <th>status</th>
                  <th>detail</th>
                  <th>evidence</th>
                </tr>
              </thead>
              <tbody id="goLiveChecklistRows"></tbody>
            </table>
          </div>
          <h4>建议说明</h4>
          <ul id="goLiveNoteList" class="list"></ul>
        </article>

        <article class="card">
          <h3>成交台账</h3>
          <div class="actions-row wrap">
            <label>
              symbol
              <input id="holdingTradeFilterSymbolInput" type="text" placeholder="留空=全部" />
            </label>
            <label>
              start_date
              <input id="holdingTradeFilterStartDateInput" type="date" />
            </label>
            <label>
              end_date
              <input id="holdingTradeFilterEndDateInput" type="date" />
            </label>
            <label>
              limit
              <input id="holdingTradeFilterLimitInput" type="number" min="1" max="5000" value="500" />
            </label>
            <button id="applyHoldingTradeFilterBtn" type="button" class="secondary">按条件刷新</button>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>id</th>
                  <th>trade_date</th>
                  <th>symbol</th>
                  <th>name</th>
                  <th>side</th>
                  <th>price</th>
                  <th>reference_price</th>
                  <th>executed_at</th>
                  <th>partial_fill</th>
                  <th>unfilled_reason</th>
                  <th>lots</th>
                  <th>qty</th>
                  <th>fee</th>
                  <th>note</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="holdingTradeRows"></tbody>
            </table>
          </div>
        </article>

        <div class="kpi-grid compact">
          <article class="kpi-card"><p>持仓标的数</p><h3 id="holdingPositionCountKpi">-</h3></article>
          <article class="kpi-card"><p>持仓总股数</p><h3 id="holdingQuantityKpi">-</h3></article>
          <article class="kpi-card"><p>总成本</p><h3 id="holdingCostKpi">-</h3></article>
          <article class="kpi-card"><p>总市值</p><h3 id="holdingMarketValueKpi">-</h3></article>
          <article class="kpi-card"><p>浮动盈亏</p><h3 id="holdingPnlKpi">-</h3></article>
          <article class="kpi-card"><p>浮动收益率</p><h3 id="holdingPnlPctKpi">-</h3></article>
        </div>

        <article class="card">
          <h3>当前持仓快照（/holdings/positions）</h3>
          <p id="holdingPositionMeta" class="muted">-</p>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>symbol</th>
                  <th>name</th>
                  <th>qty</th>
                  <th>lots</th>
                  <th>avg_cost</th>
                  <th>latest</th>
                  <th>day_change</th>
                  <th>cost_value</th>
                  <th>market_value</th>
                  <th>unrealized</th>
                  <th>weight</th>
                  <th>momentum20</th>
                  <th>volatility20</th>
                  <th>fundamental</th>
                  <th>comment</th>
                </tr>
              </thead>
              <tbody id="holdingPositionRows"></tbody>
            </table>
          </div>
        </article>

        <article class="card">
          <h3>次日预测与交易建议（/holdings/analyze）</h3>
          <p id="holdingOverviewMeta" class="muted">尚未运行持仓分析。</p>
          <h4>持仓分析明细</h4>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>symbol</th>
                  <th>name</th>
                  <th>signal</th>
                  <th>expected_ret</th>
                  <th>up_prob</th>
                  <th>suggested_action</th>
                  <th>delta_lots</th>
                  <th>exec_window</th>
                  <th>avoid_windows</th>
                  <th>intraday_risk</th>
                  <th>event_net</th>
                  <th>style_regime</th>
                  <th>analysis_note</th>
                </tr>
              </thead>
              <tbody id="holdingAnalyzePositionRows"></tbody>
            </table>
          </div>
          <h4>推荐动作清单</h4>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>symbol</th>
                  <th>name</th>
                  <th>action</th>
                  <th>target_lots</th>
                  <th>delta_lots</th>
                  <th>confidence</th>
                  <th>expected_ret</th>
                  <th>up_prob</th>
                  <th>next_trade_date</th>
                  <th>style_regime</th>
                  <th>exec_window</th>
                  <th>avoid_windows</th>
                  <th>intraday_risk</th>
                  <th>stop_loss_hint</th>
                  <th>take_profit_hint</th>
                  <th>risk_flags</th>
                  <th>rationale</th>
                </tr>
              </thead>
              <tbody id="holdingRecommendationRows"></tbody>
            </table>
          </div>
        </article>
      </section>

      <section id="tab-execution" class="tab-panel" data-animate>
        <div class="panel-head">
          <h2>交易准备单与执行回写页</h2>
          <p>把建议动作落到人工下单，再回写执行结果并生成复盘报表。</p>
        </div>

        <article class="card">
          <h3>交易准备单（最近一次信号生成）</h3>
          <p class="muted">点击“填入执行单”可自动把 signal_id / symbol / side 带入执行回写表单。</p>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>标的</th>
                  <th>动作</th>
                  <th>置信度</th>
                  <th>风险摘要</th>
                  <th>建议条数</th>
                  <th>signal_id</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="prepRows"></tbody>
            </table>
          </div>
        </article>

        <div class="grid two">
          <article class="card">
            <h3>信号记录库（/replay/signals）</h3>
            <div class="actions-row wrap">
              <label>
                symbol
                <input id="replaySignalSymbol" type="text" placeholder="留空=全部" />
              </label>
              <label>
                limit
                <input id="replaySignalLimit" type="number" min="1" max="2000" value="200" />
              </label>
              <button id="loadReplaySignalsBtn" type="button">加载信号记录</button>
            </div>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>signal_id</th>
                    <th>标的</th>
                    <th>策略</th>
                    <th>日期</th>
                    <th>动作</th>
                    <th>置信度</th>
                    <th>原因</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody id="replaySignalRows"></tbody>
              </table>
            </div>
          </article>

          <article class="card">
            <h3>执行回写（/replay/executions/record）</h3>
            <div class="form-grid">
              <label>
                signal_id
                <input id="execSignalId" type="text" />
              </label>
              <label>
                symbol
                <input id="execSymbol" type="text" />
              </label>
              <label>
                execution_date
                <input id="execDate" type="date" />
              </label>
              <label>
                side
                <select id="execSide">
                  <option value="BUY">BUY</option>
                  <option value="SELL">SELL</option>
                  <option value="WATCH">WATCH</option>
                </select>
              </label>
              <label>
                quantity
                <input id="execQty" type="number" min="0" value="100" />
              </label>
              <label>
                price
                <input id="execPrice" type="number" min="0" step="0.0001" value="0" />
              </label>
              <label>
                reference_price
                <input id="execReferencePrice" type="number" min="0" step="0.0001" value="" placeholder="用于计算执行滑点" />
              </label>
              <label>
                fee
                <input id="execFee" type="number" min="0" step="0.0001" value="0" />
              </label>
              <label>
                note
                <textarea id="execNote" rows="3" placeholder="记录人工下单说明"></textarea>
              </label>
            </div>
            <div class="actions-row">
              <button id="submitExecutionBtn" type="button">提交执行回写</button>
            </div>
            <p id="execSubmitMsg" class="muted">-</p>
          </article>
        </div>

        <article class="card">
          <h3>执行复盘报表（/replay/report）</h3>
          <div class="actions-row wrap">
            <label>
              symbol
              <input id="reportSymbol" type="text" placeholder="留空=全部" />
            </label>
            <label>
              strategy_name
              <input id="reportStrategyName" type="text" placeholder="留空=全部" />
            </label>
            <label>
              start_date
              <input id="reportStartDate" type="date" />
            </label>
            <label>
              end_date
              <input id="reportEndDate" type="date" />
            </label>
            <label>
              limit
              <input id="reportLimit" type="number" min="1" max="2000" value="500" />
            </label>
            <button id="loadReplayReportBtn" type="button">加载复盘报表</button>
          </div>

          <div class="kpi-grid compact">
            <article class="kpi-card"><p>样本数</p><h3 id="reportSample">-</h3></article>
            <article class="kpi-card"><p>跟随率</p><h3 id="reportFollowRate">-</h3></article>
            <article class="kpi-card"><p>平均延迟(天)</p><h3 id="reportAvgDelay">-</h3></article>
            <article class="kpi-card"><p>平均滑点(bps)</p><h3 id="reportAvgSlip">-</h3></article>
          </div>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>signal_id</th>
                  <th>标的</th>
                  <th>信号动作</th>
                  <th>执行动作</th>
                  <th>执行数量</th>
                  <th>执行价格</th>
                  <th>延迟(天)</th>
                  <th>跟随</th>
                </tr>
              </thead>
              <tbody id="replayReportRows"></tbody>
            </table>
          </div>
        </article>

        <article class="card">
          <h3>偏差归因与闭环复盘（/replay/attribution + /reports/generate）</h3>
          <div class="actions-row wrap">
            <label>
              symbol
              <input id="attrSymbolInput" type="text" placeholder="留空=全部" />
            </label>
            <label>
              strategy_name
              <input id="attrStrategyInput" type="text" placeholder="留空=全部" />
            </label>
            <label>
              start_date
              <input id="attrStartDateInput" type="date" />
            </label>
            <label>
              end_date
              <input id="attrEndDateInput" type="date" />
            </label>
            <label>
              limit
              <input id="attrLimitInput" type="number" min="1" max="2000" value="500" />
            </label>
            <button id="loadReplayAttributionBtn" type="button">加载偏差归因</button>
            <button id="generateClosureReportBtn" type="button" class="secondary">生成 closure 报表</button>
          </div>
          <div class="kpi-grid compact">
            <article class="kpi-card"><p>样本数</p><h3 id="attrSample">-</h3></article>
            <article class="kpi-card"><p>跟随率</p><h3 id="attrFollowRate">-</h3></article>
            <article class="kpi-card"><p>平均延迟(天)</p><h3 id="attrAvgDelay">-</h3></article>
            <article class="kpi-card"><p>平均滑点(bps)</p><h3 id="attrAvgSlip">-</h3></article>
          </div>
          <div class="grid two">
            <div>
              <h4>偏差原因统计</h4>
              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>reason_code</th>
                      <th>count</th>
                      <th>ratio</th>
                      <th>drag_bps</th>
                    </tr>
                  </thead>
                  <tbody id="attributionReasonRows"></tbody>
                </table>
              </div>
            </div>
            <div>
              <h4>参数修正建议</h4>
              <ul id="attributionSuggestionList" class="list"></ul>
            </div>
          </div>
          <h4>归因明细</h4>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>signal_id</th>
                  <th>symbol</th>
                  <th>strategy</th>
                  <th>reason</th>
                  <th>severity</th>
                  <th>drag_bps</th>
                  <th>detail</th>
                  <th>suggestion</th>
                </tr>
              </thead>
              <tbody id="attributionItemRows"></tbody>
            </table>
          </div>
          <h4>Closure 报表输出</h4>
          <p id="closureReportMeta" class="muted">尚未生成 closure 报表。</p>
          <pre id="closureReportPreview" class="code-block">-</pre>

          <h4>成本模型重估（/replay/cost-model/calibrate）</h4>
          <div class="actions-row wrap">
            <label>
              symbol
              <input id="costModelSymbol" type="text" placeholder="留空=全部" />
            </label>
            <label>
              strategy_name
              <input id="costModelStrategy" type="text" placeholder="留空=全部" />
            </label>
            <label>
              start_date
              <input id="costModelStartDate" type="date" />
            </label>
            <label>
              end_date
              <input id="costModelEndDate" type="date" />
            </label>
            <label>
              limit
              <input id="costModelLimit" type="number" min="1" max="5000" value="1000" />
            </label>
            <label>
              min_samples
              <input id="costModelMinSamples" type="number" min="1" max="2000" value="30" />
            </label>
            <label class="checkbox-inline">
              <input id="costModelSaveRecord" type="checkbox" checked />
              保存重估记录
            </label>
            <button id="runCostCalibrationBtn" type="button">运行成本重估</button>
          </div>
          <p id="costModelMeta" class="muted">尚未运行成本模型重估。</p>
          <div class="grid two">
            <div>
              <h4>推荐参数</h4>
              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>parameter</th>
                      <th>value</th>
                    </tr>
                  </thead>
                  <tbody id="costModelRecommendationRows"></tbody>
                </table>
              </div>
            </div>
            <div>
              <h4>说明</h4>
              <ul id="costModelNoteList" class="list"></ul>
            </div>
          </div>
          <h4>重估历史（/replay/cost-model/calibrations）</h4>
          <div class="actions-row wrap">
            <label>
              history_limit
              <input id="costModelHistoryLimit" type="number" min="1" max="200" value="30" />
            </label>
            <button id="loadCostCalibrationHistoryBtn" type="button" class="secondary">刷新重估历史</button>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>id</th>
                  <th>created_at</th>
                  <th>symbol</th>
                  <th>strategy</th>
                  <th>samples</th>
                  <th>coverage</th>
                  <th>slippage_rate</th>
                  <th>impact_coeff</th>
                  <th>fill_floor</th>
                  <th>confidence</th>
                </tr>
              </thead>
              <tbody id="costModelHistoryRows"></tbody>
            </table>
          </div>
        </article>
      </section>
    </main>

    <script src="/ui/trading-workbench/app.js"></script>
  </body>
</html>
